<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kiosk App</title>

<style>
body { font-family: Arial, sans-serif; background:#f2f2f2; margin:10px; }
h1,h2,h3 { text-align:center; }
.section { background:#fff; padding:10px; margin:10px auto; border-radius:8px; max-width:1000px; }

.category { display:inline-block; width:200px; margin:5px; padding:5px; border-radius:6px; vertical-align:top; }

button { width:100%; padding:8px; margin:4px 0; border:none; border-radius:5px; font-weight:bold; cursor:pointer; color:#fff; }

input,select { width:95%; padding:6px; margin:4px 0; }
ul { list-style:none; padding:0; }

/* Farben */
.category.drinks { background:#d6ecff; }
.category.coffee { background:#f5e0c3; }
.category.grill { background:#ffd6d6; }
.category.bakery { background:#fff2cc; }
.category.sweets { background:#f0d6ff; }
.category.misc { background:#e0e0e0; }

.drinks button { background:#3498db; }
.coffee button { background:#a97142; }
.grill button { background:#e74c3c; }
.bakery button { background:#f1c40f; color:#000; }
.sweets button { background:#9b59b6; }
.misc button { background:#7f8c8d; }

.cart-btn { background:#2ecc71; }
.expense-btn { background:#e74c3c; }
.admin button { background:#7f8c8d; }
</style>
</head>

<body>

<h1>Kiosk App</h1>

<!-- ================= PRODUKTE ================= -->
<div class="section">
<h2>Produkte</h2>

<div class="category drinks" id="cat-drinks">
<h3>Getränke</h3>
<button onclick="addToCart('Wasser',1)">Wasser 1,00 €</button>
<button onclick="addToCart('Cola',2)">Cola 2,00 €</button>
</div>

<div class="category coffee" id="cat-coffee">
<h3>Kaffee & Kuchen</h3>
<button onclick="addToCart('Kaffee',2.5)">Kaffee 2,50 €</button>
<button onclick="addToCart('Kuchen',3)">Kuchen 3,00 €</button>
</div>

<div class="category grill" id="cat-grill">
<h3>Grill</h3>
<button onclick="addToCart('Würstel',2.5)">Würstel 2,50 €</button>
<button onclick="addToCart('Steak',5)">Steak 5,00 €</button>
</div>

<div class="category bakery" id="cat-bakery">
<h3>Backwaren</h3>
<button onclick="addToCart('Breze',1.5)">Breze 1,50 €</button>
<button onclick="addToCart('Wurstsemmel',3)">Wurstsemmel 3,00 €</button>
</div>

<div class="category sweets" id="cat-sweets">
<h3>Süßigkeiten</h3>
<button onclick="addToCart('Schokolade',1.2)">Schokolade 1,20 €</button>
<button onclick="addToCart('Gummibärchen',1)">Gummibärchen 1,00 €</button>
</div>

<div class="category misc">
<h3>Sonstiges</h3>
<input id="miscName" placeholder="Bezeichnung">
<input id="miscPrice" type="number" step="0.01" placeholder="Preis €">
<button onclick="addMisc()">Hinzufügen</button>
</div>

</div>

<!-- ================= WARENKORB ================= -->
<div class="section">
<h2>Warenkorb</h2>
<ul id="cart"></ul>
<p><b>Gesamt:</b> <span id="cartTotal">0.00</span> €</p>
<button class="cart-btn" onclick="checkout()">Einkauf abschließen</button>
<button onclick="clearCart()" style="background:#e74c3c"> Warenkorb leeren</button>


</div>

<!-- ================= PRODUKT HINZUFÜGEN ================= -->
<div class="section admin">
<h2>Produkt hinzufügen</h2>
<input id="pName" placeholder="Produktname">
<input id="pPrice" type="number" step="0.01" placeholder="Preis €">
<select id="pCategory">
<option value="">Kategorie wählen</option>
<option value="drinks">Getränke</option>
<option value="coffee">Kaffee & Kuchen</option>
<option value="grill">Grill</option>
<option value="bakery">Backwaren</option>
<option value="sweets">Süßigkeiten</option>
</select>
<button onclick="addNewProduct()">Produkt speichern</button>
</div>

<!-- ================= AUSGABEN ================= -->
<div class="section">
<h2>Ausgaben</h2>
<input id="expText" placeholder="Wofür?">
<input id="expPrice" type="number" step="0.01" placeholder="Betrag €">
<button class="expense-btn" onclick="addExpense()">Ausgabe hinzufügen</button>
</div>

<!-- ================= KASSE ================= -->
<div class="section">
<h2>Kasse / Tagesabschluss</h2>

<label>Kassenbestand Start (€)</label>
<input id="cashStartInput" type="number" step="0.01">
<button onclick="setCashStart()">Kasse übernehmen</button>

<p>Einnahmen: <b><span id="rev">0.00</span> €</b></p>
<p>Ausgaben: <b><span id="exp">0.00</span> €</b></p>
<p>Gewinn: <b><span id="gain">0.00</span> €</b></p>

<p>Kassenbestand Soll: <b><span id="cashSoll">0.00</span> €</b></p>

<label>Kassenbestand Ist</label>
<input id="cashEndInput" type="number" step="0.01" oninput="updateTotals()">

<p>Differenz: <b><span id="cashDiff">0.00</span> €</b></p>

<button onclick="exportCSV()">CSV Export</button>
</div>

<script>
/* ===== STATE ===== */
let cart = [];
let revenue = 0;
let cashStart = 0;
let salesLog = [];
let expenseList = [];

/* ===== WARENKORB ===== */
function addToCart(name, price) {
  cart.push({ name, price });
  renderCart();
}

function addMisc() {
  const name = miscName.value.trim() || "Sonstiges";
  const price = Number(miscPrice.value);
  if (price <= 0 || isNaN(price)) return;
  cart.push({ name, price });
  miscPrice.value = "";
  renderCart();
}

function renderCart() {
  const ul = document.getElementById("cart");
  const totalEl = document.getElementById("cartTotal");

  ul.innerHTML = "";          // ✅ DOM leeren
  let sum = 0;

  cart.forEach(item => {
    sum += item.price;
    const li = document.createElement("li");
    li.textContent = `${item.name} – ${item.price.toFixed(2)} €`;
    ul.appendChild(li);
  });

  totalEl.textContent = sum.toFixed(2);
}

/* ===== CHECKOUT ===== */
function checkout() {
  if (cart.length === 0) return;

  const time = new Date().toLocaleString();

  cart.forEach(item => {
    revenue += item.price;
    salesLog.push({
      time,
      name: item.name,
      price: item.price,
      type: "Einnahme"
    });
  });

  // ✅ Warenkorb korrekt leeren
  cart.length = 0;

  // ✅ UI aktualisieren
  renderCart();
  updateTotals();
}

/* ===== AUSGABEN ===== */
function addExpense() {
  const text = expText.value.trim();
  const price = Number(expPrice.value);
  if (!text || price<=0) return;
  expenseList.push({time:new Date().toLocaleString(),name:text,price,type:"Ausgabe"});
  expText.value=""; expPrice.value="";
  updateTotals();
}

/* ===== KASSE ===== */
function setCashStart() {
  cashStart = Number(cashStartInput.value) || 0;
  updateTotals();
}

function updateTotals() {
  const totalExpenses = expenseList.reduce(
    (sum, e) => sum + e.price,
    0
  );

  const cashSoll = cashStart + revenue - totalExpenses;

  const rawIst = document.getElementById("cashEndInput").value;
  const cashIst = rawIst === "" ? null : Number(rawIst);

  document.getElementById("rev").textContent =
    revenue.toFixed(2);

  document.getElementById("exp").textContent =
    totalExpenses.toFixed(2);

  document.getElementById("gain").textContent =
    (revenue - totalExpenses).toFixed(2);

  document.getElementById("cashSoll").textContent =
    cashSoll.toFixed(2);

  document.getElementById("cashDiff").textContent =
    cashIst === null
      ? "0.00"
      : (cashIst - cashSoll).toFixed(2);
}
function clearCart() {
  if (cart.length === 0) {
    alert("Warenkorb ist bereits leer");
    return;
  }

  if (!confirm("Warenkorb wirklich leeren?")) return;

  cart = [];
  renderCart();
}


/* ===== PRODUKT HINZUFÜGEN ===== */
function addNewProduct() {
  const name=pName.value.trim();
  const price=Number(pPrice.value);
  const cat=pCategory.value;
  if(!name||price<=0||!cat) return;

  const c=document.getElementById("cat-"+cat);
  const row=document.createElement("div");
  row.style.display="flex"; row.style.gap="5px";

  const b=document.createElement("button");
  b.textContent=`${name} ${price.toFixed(2)} €`;
  b.onclick=()=>addToCart(name,price);

  const d=document.createElement("button");
  d.textContent="❌"; d.style.width="40px"; d.style.background="#e74c3c";
  d.onclick=()=>row.remove();

  row.appendChild(b); row.appendChild(d); c.appendChild(row);
  pName.value=pPrice.value=pCategory.value="";
}

/* ===== CSV ===== */
function exportCSV() {

  const totalExpenses = expenseList.reduce(
    (sum, e) => sum + e.price, 0
  );

  const cashSoll = cashStart + revenue - totalExpenses;

  const cashIst = Number(
    document.getElementById("cashEndInput").value
  ) || 0;

  const diff = cashIst - cashSoll;

  let rows = [];
  rows.push("Datum/Uhrzeit;Typ;Bezeichnung;Betrag");

  /* ===== EINNAHMEN ===== */
  salesLog.forEach(e => {
    rows.push(
      `"${e.time}";"Einnahme";"${e.name}";"${e.price.toFixed(2).replace(".", ",")}"`
    );
  });

  /* ===== AUSGABEN ===== */
  expenseList.forEach(e => {
    rows.push(
      `"${e.time}";"Ausgabe";"${e.name}";"${e.price.toFixed(2).replace(".", ",")}"`
    );
  });

  /* ===== ZUSAMMENFASSUNG ===== */
  rows.push("");
  rows.push(`"";"Kassenstart";"";"${cashStart.toFixed(2).replace(".", ",")}"`);
  rows.push(`"";"Summe Einnahmen";"";"${revenue.toFixed(2).replace(".", ",")}"`);
  rows.push(`"";"Summe Ausgaben";"";"${totalExpenses.toFixed(2).replace(".", ",")}"`);
  rows.push(`"";"Kassenbestand Soll";"";"${cashSoll.toFixed(2).replace(".", ",")}"`);
  rows.push(`"";"Kassenbestand Ist";"";"${cashIst.toFixed(2).replace(".", ",")}"`);
  rows.push(`"";"Differenz";"";"${diff.toFixed(2).replace(".", ",")}"`);

  const blob = new Blob(
    ["\uFEFF" + rows.join("\n")],
    { type: "text/csv;charset=utf-8;" }
  );

  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "kiosk_tagesabschluss.csv";
  a.click();
}
</script>

</body>
</html>
